<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÉTODO 360 PRO | Arquivo Seguro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --azul: #003366; --cinza: #f8f9fa; --verde: #198754; }
        body { background: var(--cinza); font-family: 'Segoe UI', sans-serif; display: none; padding-bottom: 50px; }
        .card-clinico { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin: 15px auto; max-width: 650px; border-top: 8px solid var(--azul); }
        .etapa { display: none; }
        .ativa { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .grid-pulsos { display: grid; grid-template-columns: 1fr; gap: 8px; margin-top: 15px; }
        .item-pulso { background: #fff; border: 1px solid #eee; padding: 10px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; }
        .sigla { font-weight: 800; color: var(--azul); width: 45px; }
        .btn-scale { font-size: 0.7rem; padding: 5px 2px; min-width: 32px; border: 1px solid #ddd; background: white; }
        .btn-check:checked + .btn { background: var(--azul) !important; color: white !important; }
        .btn-pro { background: var(--azul); color: white; width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; margin-top: 20px; font-size: 1.1rem; }
    </style>
</head>
<body id="corpoApp">

    <div id="p1" class="etapa ativa container mt-4">
        <div class="card-clinico text-center">
            <h3 class="fw-bold mb-4" style="color:var(--azul)">MÉTODO 360 PRO</h3>
            <input type="text" id="pacienteId" class="form-control mb-3" placeholder="ID do Paciente">
            <textarea id="queixa" class="form-control mb-3" rows="3" placeholder="Queixa Principal"></textarea>
            <button class="btn-pro" onclick="ir(2)">INICIAR AVALIAÇÃO</button>
        </div>
    </div>

    <div id="p2" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">Diagnóstico Base (1x)</h5>
            <p class="small text-muted">Ansiedade (GAD-7) e Sono (IGI)</p>
            <div id="diagBox"></div>
            <button class="btn-pro" onclick="ir(3)">PRÓXIMO: EVA ANTES</button>
        </div>
    </div>

    <div id="p3" class="etapa container mt-4">
        <div class="card-clinico text-center">
            <h5 class="fw-bold border-bottom pb-2">EVA (Antes do Atendimento)</h5>
            <div id="evaPreBox" class="d-flex flex-wrap justify-content-center mt-3"></div>
            <button class="btn-pro" onclick="ir(4)">PRÓXIMO: EXAME FÍSICO</button>
        </div>
    </div>

    <div id="p4" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">Exame dos 12 Pulsos</h5>
            <div class="grid-pulsos" id="pulsosBox"></div>
            <hr>
            <label class="fw-bold small">Língua:</label>
            <select id="lingua" class="form-select mt-1"><option>Rosada</option><option>Pálida</option><option>Vermelha</option></select>
            <button class="btn-pro" onclick="ir(5)" style="background:var(--verde)">IR PARA EVA PÓS</button>
        </div>
    </div>

    <div id="p5" class="etapa container mt-4">
        <div class="card-clinico text-center">
            <h5 class="fw-bold border-bottom pb-2">EVA (Depois do Atendimento)</h5>
            <div id="evaPosBox" class="d-flex flex-wrap justify-content-center mt-3"></div>
            <button id="btnSalvar" class="btn-pro" onclick="finalizarEAquivar()">FINALIZAR E ARQUIVAR</button>
        </div>
    </div>

    <script>
        // Segurança
        if(prompt("PIN:") !== "1234") { document.body.innerHTML = "Bloqueado"; } else { document.body.style.display = "block"; }

        // CONFIGURAÇÃO FIREBASE (Dados extraídos da sua imagem)
        const firebaseConfig = {
            apiKey: "AIzaSyAI5X-Cb0Xf0G_cRoBX9YWqW1bn0nv-RA",
            authDomain: "metodo360pro-db0aa.firebaseapp.com",
            projectId: "metodo360pro-db0aa",
            storageBucket: "metodo360pro-db0aa.firebasestorage.app",
            messagingSenderId: "1088396585788",
            appId: "1:1088396585788:web:57853a7b0ff17c8306ec39",
            measurementId: "G-589QFHBJC4"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Gerar Interface
        const meridianos = ["P", "IG", "BP", "E", "C", "ID", "R", "B", "CS", "TA", "F", "VB"];
        const niveis = ["---", "--", "-", "ok", "+", "++", "+++"];

        function montar() {
            for(let n=0; n<=10; n++) {
                const btn = `<input type="radio" class="btn-check" name="pre" id="pre${n}" value="${n}"><label class="btn btn-outline-primary m-1" for="pre${n}">${n}</label>`;
                const btn2 = `<input type="radio" class="btn-check" name="pos" id="pos${n}" value="${n}"><label class="btn btn-outline-primary m-1" for="pos${n}">${n}</label>`;
                document.getElementById('evaPreBox').innerHTML += btn;
                document.getElementById('evaPosBox').innerHTML += btn2;
            }
            meridianos.forEach(m => {
                let b = niveis.map(n => `<input type="radio" class="btn-check" name="p_${m}" id="${m}_${n}" value="${n}" ${n==='ok'?'checked':''}><label class="btn btn-outline-secondary btn-scale" for="${m}_${n}">${n}</label>`).join('');
                document.getElementById('pulsosBox').innerHTML += `<div class="item-pulso"><span class="sigla">${m}</span><div class="btn-group">${b}</div></div>`;
            });
        }
        montar();

        function ir(n) { document.querySelectorAll('.etapa').forEach(e => e.classList.remove('ativa')); document.getElementById('p' + n).classList.add('ativa'); window.scrollTo(0,0); }

        function finalizarEAquivar() {
            const btn = document.getElementById('btnSalvar');
            btn.disabled = true; btn.innerText = "Gravando...";
            const dados = {
                paciente: document.getElementById('pacienteId').value,
                queixa: document.getElementById('queixa').value,
                data: new Date().toLocaleString(),
                evaPre: document.querySelector('[name="pre"]:checked')?.value || "0",
                evaPos: document.querySelector('[name="pos"]:checked')?.value || "0"
            };
            db.collection("atendimentos").add(dados).then(() => {
                alert("Atendimento arquivado com sucesso!");
                location.reload();
            }).catch(e => { alert("Erro ao salvar!"); btn.disabled = false; });
        }
    </script>
</body>
</html>
