<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÉTODO 360 PRO | Evolutivo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --azul: #003366; --cinza: #f8f9fa; --verde: #28a745; }
        body { background: var(--cinza); font-family: 'Segoe UI', sans-serif; display: none; padding-bottom: 50px; }
        .card-clinico { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin: 15px auto; max-width: 600px; border-top: 6px solid var(--azul); }
        .etapa { display: none; }
        .ativa { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .pergunta-escala { border-bottom: 1px solid #eee; padding: 12px 0; }
        .label-pergunta { font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 8px; color: #444; }
        .sigla { font-weight: 800; color: var(--azul); width: 45px; }
        .grid-pulsos { display: grid; grid-template-columns: 1fr; gap: 8px; }
        .item-pulso { background: #fff; border: 1px solid #eee; padding: 10px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; }
        .btn-scale { font-size: 0.7rem; padding: 5px 2px; min-width: 32px; border: 1px solid #ddd; }
        .btn-check:checked + .btn { background: var(--azul) !important; color: white !important; }
        .btn-pro { background: var(--azul); color: white; width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; margin-top: 20px; font-size: 1rem; }
        .evolucao-box { background: #e9ecef; border-radius: 10px; padding: 15px; margin-top: 10px; }
    </style>
</head>
<body id="corpoApp">

    <div id="p1" class="etapa ativa container mt-4">
        <div class="card-clinico">
            <h4 class="fw-bold text-center mb-4" style="color:var(--azul)">MÉTODO 360 PRO</h4>
            <label class="small fw-bold">ID do Paciente:</label>
            <input type="text" id="pacienteId" class="form-control mb-3" placeholder="Ex: MRO 5005">
            <label class="small fw-bold">Queixa Principal:</label>
            <textarea id="queixa" class="form-control mb-3" rows="3" placeholder="Descreva o motivo da consulta..."></textarea>
            <button class="btn-pro" onclick="ir(2)">INICIAR AVALIAÇÃO PRÉ</button>
        </div>
    </div>

    <div id="p2" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">GAD-7 (Antes do Atendimento)</h5>
            <div id="questoesGadPre"></div>
            <button class="btn-pro" onclick="ir(3)">PRÓXIMO: SONO (IGI)</button>
        </div>
    </div>

    <div id="p3" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">Índice IGI (Sono)</h5>
            <div id="questoesIgi"></div>
            <button class="btn-pro" onclick="ir(4)">PRÓXIMO: EXAME FÍSICO</button>
        </div>
    </div>

    <div id="p4" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2 text-primary">Diagnóstico de Língua e Pulsos</h5>
            <div class="row mb-3">
                <div class="col-6"><label class="small fw-bold">Cor:</label><select id="cor" class="form-select"><option value="Rosada">Rosada</option><option value="Pálida">Pálida</option><option value="Vermelha">Vermelha</option><option value="Roxa">Roxa</option></select></div>
                <div class="col-6"><label class="small fw-bold">Saburra:</label><select id="sab" class="form-select"><option value="Fina">Fina</option><option value="Grossa">Grossa</option><option value="Geográfica">Geográfica</option></select></div>
            </div>
            <div class="grid-pulsos" id="listaPulsos"></div>
            <button class="btn-pro" onclick="ir(5)" style="background:var(--verde)">REALIZAR ATENDIMENTO (PÓS)</button>
        </div>
    </div>

    <div id="p5" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">GAD-7 (Após o Atendimento)</h5>
            <p class="small text-muted">Como o paciente se sente *agora*?</p>
            <div id="questoesGadPos"></div>
            <button class="btn-pro" onclick="finalizar()">FINALIZAR E COMPARAR</button>
        </div>
    </div>

    <div id="p6" class="etapa container mt-4">
        <div class="card-clinico">
            <h4 class="fw-bold text-success border-bottom pb-2 text-center">Relatório 360 PRO</h4>
            <div id="relatorio" class="mt-3"></div>
            <button class="btn-pro" onclick="window.print()">SALVAR EM PDF / IMPRIMIR</button>
            <button class="btn btn-link w-100 mt-2 text-muted" onclick="location.reload()">Novo Atendimento</button>
        </div>
    </div>

    <script>
        const PIN = "1234";
        const entrada = prompt("PIN do Terapeuta:");
        if(entrada !== PIN) { document.body.innerHTML = "Acesso Negado"; } else { document.body.style.display = "block"; }

        const gadPerguntas = ["Sentir-se nervoso ou tenso", "Controlar preocupações", "Preocupar-se demais", "Dificuldade para relaxar", "Agitação", "Irritabilidade", "Medo de algo horrível"];
        const igiPerguntas = ["Dificuldade adormecer", "Dificuldade manter sono", "Acordar cedo demais", "Satisfação com sono", "Interferência diária", "Perceção alheia", "Angústia com sono"];

        function gerarEscala(idAlvo, perguntas, max) {
            const container = document.getElementById(idAlvo);
            perguntas.forEach((p, i) => {
                let opcoes = "";
                for(let n=0; n<=max; n++) {
                    opcoes += `<input type="radio" class="btn-check" name="${idAlvo}_${i}" id="${idAlvo}_${i}_${n}" value="${n}" ${n===0?'checked':''}><label class="btn btn-outline-secondary btn-sm me-1" for="${idAlvo}_${i}_${n}">${n}</label>`;
                }
                container.innerHTML += `<div class="pergunta-escala"><span class="label-pergunta">${p}</span><div class="btn-group">${opcoes}</div></div>`;
            });
        }

        gerarEscala("questoesGadPre", gadPerguntas, 3);
        gerarEscala("questoesGadPos", gadPerguntas, 3);
        gerarEscala("questoesIgi", igiPerguntas, 4);

        const meridianos = ["P", "IG", "BP", "E", "C", "ID", "R", "B", "CS", "TA", "F", "VB"];
        const gridP = document.getElementById('listaPulsos');
        meridianos.forEach(m => {
            let botoes = ["---","--","-","ok","+","++","+++"].map(n => `<input type="radio" class="btn-check" name="p_${m}" id="${m}_${n}" value="${n}" ${n==='ok'?'checked':''}><label class="btn btn-outline-secondary btn-scale" for="${m}_${n}">${n}</label>`).join('');
            gridP.innerHTML += `<div class="item-pulso"><span class="sigla">${m}</span><div class="btn-group">${botoes}</div></div>`;
        });

        function ir(n) { document.querySelectorAll('.etapa').forEach(e => e.classList.remove('ativa')); document.getElementById('p' + n).classList.add('ativa'); window.scrollTo(0,0); }

        function finalizar() {
            let pre = 0; document.querySelectorAll('[name^="questoesGadPre_"]:checked').forEach(i => pre += parseInt(i.value));
            let pos = 0; document.querySelectorAll('[name^="questoesGadPos_"]:checked').forEach(i => pos += parseInt(i.value));
            let igi = 0; document.querySelectorAll('[name^="questoesIgi_"]:checked').forEach(i => igi += parseInt(i.value));
            let pulsos = []; meridianos.forEach(m => { let v = document.querySelector(`input[name="p_${m}"]:checked`).value; if(v!=='ok') pulsos.push(`<b>${m}:</b> ${v}`); });

            const diff = pre - pos;
            const melhoraTxt = diff > 0 ? `<b class='text-success'>Melhora imediata de ${diff} pontos no GAD-7</b>` : `Estabilidade nos níveis de tensão.`;

            document.getElementById('relatorio').innerHTML = `
                <div class='mb-2'><b>Paciente:</b> ${document.getElementById('pacienteId').value}</div>
                <div class='mb-2'><b>Queixa:</b> ${document.getElementById('queixa').value}</div>
                <hr>
                <div class='evolucao-box'>
                    <b>Evolução da Ansiedade (GAD-7):</b><br>
                    Antes: ${pre} pts | Depois: ${pos} pts<br>
                    ${melhoraTxt}
                </div>
                <div class='mt-2'><b>Gravidade Insônia (IGI):</b> ${igi} pts</div>
                <hr>
                <b>Pulsos Alterados:</b> ${pulsos.join(' | ') || 'Nenhum'}<br>
                <b>Língua:</b> ${document.getElementById('cor').value} / ${document.getElementById('sab').value}
            `;
            ir(6);
        }
    </script>
</body>
</html>
