<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÉTODO 360 PRO | Prontuário</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --azul: #003366; --cinza: #f8f9fa; --danger: #dc3545; --success: #198754; }
        body { background: var(--cinza); font-family: 'Segoe UI', sans-serif; display: none; padding-bottom: 50px; }
        .card-clinico { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin: 15px auto; max-width: 600px; border-top: 6px solid var(--azul); }
        .etapa { display: none; }
        .ativa { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .pergunta-escala { border-bottom: 1px solid #eee; padding: 12px 0; }
        .label-pergunta { font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 8px; color: #444; }
        .grid-pulsos { display: grid; grid-template-columns: 1fr; gap: 8px; }
        .item-pulso { background: #fff; border: 1px solid #eee; padding: 10px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; }
        .sigla { font-weight: 800; color: var(--azul); width: 45px; }
        .btn-scale { font-size: 0.7rem; padding: 5px 2px; min-width: 32px; border: 1px solid #ddd; background: white; }
        .btn-check:checked + .btn { background: var(--azul) !important; color: white !important; }
        .btn-pro { background: var(--azul); color: white; width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; margin-top: 20px; }
        .eva-btn { min-width: 35px; font-weight: bold; border: 1px solid #ddd; margin: 2px; }
    </style>
</head>
<body id="corpoApp">

    <div id="p1" class="etapa ativa container mt-4">
        <div class="card-clinico">
            <h4 class="fw-bold text-center mb-4" style="color:var(--azul)">MÉTODO 360 PRO</h4>
            <label class="small fw-bold">ID do Paciente:</label>
            <input type="text" id="pacienteId" class="form-control mb-3" placeholder="Ex: MRO 5005">
            <label class="small fw-bold">Queixa Principal:</label>
            <textarea id="queixa" class="form-control mb-3" rows="3" placeholder="Descreva o motivo da consulta..."></textarea>
            <button class="btn-pro" onclick="ir(2)">PRÓXIMO: GAD-7 & SONO</button>
        </div>
    </div>

    <div id="p2" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">Diagnóstico Base (GAD-7 & IGI)</h5>
            <div id="questoesGad"></div>
            <hr>
            <div id="questoesIgi"></div>
            <button class="btn-pro" onclick="ir(3)">PRÓXIMO: EVA PRÉ</button>
        </div>
    </div>

    <div id="p3" class="etapa container mt-4">
        <div class="card-clinico text-center">
            <h5 class="fw-bold border-bottom pb-2">Escala EVA (Antes)</h5>
            <p class="small text-muted">Nível de dor/desconforto inicial (0 a 10):</p>
            <div class="d-flex flex-wrap justify-content-center" id="evaPreBox"></div>
            <button class="btn-pro" onclick="ir(4)">PRÓXIMO: EXAME FÍSICO</button>
        </div>
    </div>

    <div id="p4" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2 text-primary">Pulsologia & Língua</h5>
            <div class="row mb-3">
                <div class="col-6"><label class="small fw-bold">Cor da Língua:</label><select id="cor" class="form-select"><option value="Rosada">Rosada</option><option value="Pálida">Pálida</option><option value="Vermelha">Vermelha</option><option value="Roxa">Roxa</option></select></div>
                <div class="col-6"><label class="small fw-bold">Saburra:</label><select id="sab" class="form-select"><option value="Fina">Fina</option><option value="Grossa">Grossa</option><option value="Geográfica">Geográfica</option></select></div>
            </div>
            <div class="grid-pulsos" id="listaPulsos"></div>
            <button class="btn-pro" onclick="ir(5)" style="background:var(--success)">IR PARA EVA PÓS (APÓS TRATAMENTO)</button>
        </div>
    </div>

    <div id="p5" class="etapa container mt-4">
        <div class="card-clinico text-center">
            <h5 class="fw-bold border-bottom pb-2">Escala EVA (Depois)</h5>
            <p class="small text-muted">Nível de dor/desconforto após o atendimento:</p>
            <div class="d-flex flex-wrap justify-content-center" id="evaPosBox"></div>
            <button class="btn-pro" onclick="finalizar()">FINALIZAR ATENDIMENTO</button>
        </div>
    </div>

    <div id="p6" class="etapa container mt-4">
        <div class="card-clinico">
            <h4 class="fw-bold text-success border-bottom pb-2 text-center">Síntese 360 PRO</h4>
            <div id="relatorio" class="mt-3"></div>
            <button class="btn-pro" onclick="window.print()">IMPRIMIR / GERAR PDF</button>
            <button class="btn btn-link w-100 mt-2 text-muted" onclick="location.reload()">Novo Atendimento</button>
        </div>
    </div>

    <script>
        const PIN = "1234";
        const entrada = prompt("Acesso Restrito - PIN:");
        if(entrada !== PIN) { document.body.innerHTML = "Bloqueado"; } else { document.body.style.display = "block"; }

        // GERAR ESCALAS GAD-7 E IGI
        const gadP = ["Nervoso/Ansioso", "Controlar preocupação", "Preocupação excessiva", "Dificuldade relaxar", "Agitação", "Irritabilidade", "Medo do pior"];
        const igiP = ["Início do sono", "Manutenção do sono", "Acordar cedo", "Satisfação", "Interferência diária", "Perceção alheia", "Preocupação"];

        function montarEscala(id, p, max, titulo) {
            const cont = document.getElementById(id);
            cont.innerHTML += `<p class='fw-bold mt-2 mb-0'>${titulo}</p>`;
            p.forEach((txt, i) => {
                let btns = "";
                for(let n=0; n<=max; n++) btns += `<input type="radio" class="btn-check" name="${id}_${i}" id="${id}_${i}_${n}" value="${n}" ${n===0?'checked':''}><label class="btn btn-outline-secondary btn-sm me-1" for="${id}_${i}_${n}">${n}</label>`;
                cont.innerHTML += `<div class="pergunta-escala"><span class="label-pergunta">${txt}</span><div class="btn-group">${btns}</div></div>`;
            });
        }
        montarEscala("questoesGad", gadP, 3, "Ansiedade (GAD-7)");
        montarEscala("questoesIgi", igiP, 4, "Sono (IGI)");

        // GERAR EVA
        function montarEva(id) {
            const cont = document.getElementById(id);
            for(let n=0; n<=10; n++) {
                cont.innerHTML += `<input type="radio" class="btn-check" name="${id}" id="${id}_${n}" value="${n}" ${n===0?'checked':''}><label class="btn btn-outline-primary eva-btn" for="${id}_${n}">${n}</label>`;
            }
        }
        montarEva("evaPreBox");
        montarEva("evaPosBox");

        // GERAR PULSOS
        const meridianos = ["P", "IG", "BP", "E", "C", "ID", "R", "B", "CS", "TA", "F", "VB"];
        const gridP = document.getElementById('listaPulsos');
        meridianos.forEach(m => {
            let btns = ["---","--","-","ok","+","++","+++"].map(n => `<input type="radio" class="btn-check" name="p_${m}" id="${m}_${n}" value="${n}" ${n==='ok'?'checked':''}><label class="btn btn-outline-secondary btn-scale" for="${m}_${n}">${n}</label>`).join('');
            gridP.innerHTML += `<div class="item-pulso"><span class="sigla">${m}</span><div class="btn-group">${btns}</div></div>`;
        });

        function ir(n) { document.querySelectorAll('.etapa').forEach(e => e.classList.remove('ativa')); document.getElementById('p' + n).classList.add('ativa'); window.scrollTo(0,0); }

        function finalizar() {
            let gad = 0; document.querySelectorAll('[name^="questoesGad_"]:checked').forEach(i => gad += parseInt(i.value));
            let igi = 0; document.querySelectorAll('[name^="questoesIgi_"]:checked').forEach(i => igi += parseInt(i.value));
            let pre = parseInt(document.querySelector('[name="evaPreBox"]:checked').value);
            let pos = parseInt(document.querySelector('[name="evaPosBox"]:checked').value);
            let pulsos = []; meridianos.forEach(m => { let v = document.querySelector(`input[name="p_${m}"]:checked`).value; if(v!=='ok') pulsos.push(`<b>${m}:</b> ${v}`); });

            document.getElementById('relatorio').innerHTML = `
                <b>Paciente:</b> ${document.getElementById('pacienteId').value}<br>
                <b>Queixa:</b> ${document.getElementById('queixa').value}<hr>
                <div class='row text-center mb-3'>
                    <div class='col-6 border p-2'><b>GAD-7:</b> ${gad} pts</div>
                    <div class='col-6 border p-2'><b>IGI:</b> ${igi} pts</div>
                </div>
                <div class='p-3 text-center rounded border ${pos < pre ? 'bg-success text-white' : 'bg-light'}'>
                    <b>Evolução da Dor (EVA):</b><br>
                    Inicial: ${pre} | Final: ${pos}<br>
                    <b>Redução: ${pre - pos} pontos</b>
                </div>
                <hr>
                <b>Alterações de Pulso:</b> ${pulsos.join(' | ') || 'Normais'}<br>
                <b>Língua:</b> ${document.getElementById('cor').value} com saburra ${document.getElementById('sab').value}
            `;
            ir(6);
        }
    </script>
</body>
</html>
