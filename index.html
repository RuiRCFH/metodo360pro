<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRONTU√ÅRIO 360 PRO | Rui Ribeiro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --azul: #003366; --dourado: #B8860B; --sucesso: #28a745; }
        body { background: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .etapa { display: none; padding: 20px; max-width: 600px; margin: auto; }
        .ativa { display: block; animation: fadeIn 0.4s; }
        .card-clinico { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border-left: 10px solid var(--azul); }
        .btn-pro { background: var(--azul); color: white; padding: 15px; border-radius: 10px; width: 100%; border: none; font-weight: bold; margin-top: 20px; }
        .sugestao-box { background: #fff3cd; border-left: 5px solid #ffc107; padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 0.9rem; }
        #visor { width: 100%; height: 250px; background: #000; border-radius: 12px; position: relative; overflow: hidden; }
        video, #foto { width: 100%; height: 100%; object-fit: cover; }
        .moldura { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 140px; height: 190px; border: 2px dashed rgba(255,255,255,0.5); border-radius: 50%; pointer-events: none; }
    </style>
</head>
<body>

    <div id="p1" class="etapa ativa">
        <div class="card-clinico">
            <h4 class="fw-bold mb-3">Prontu√°rio Digital 360</h4>
            <label class="small fw-bold">ID do Paciente (Ex: MRO 5005)</label>
            <input type="text" id="pacienteId" class="form-control mb-3" placeholder="Digite o c√≥digo ou nome">
            <button class="btn-pro" onclick="ir(2)">INICIAR ATENDIMENTO</button>
        </div>
    </div>

    <div id="p2" class="etapa">
        <div class="card-clinico">
            <h5 class="fw-bold">Anamnese & Exame F√≠sico</h5>
            
            <label class="mt-3 small fw-bold">Ansiedade (GAD-7) / Sono (IGI)</label>
            <div class="d-flex gap-2">
                <select id="ans" class="form-select"><option value="0">Ansiedade: 0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
                <select id="sono" class="form-select"><option value="0">Sono: OK</option><option value="1">M√©dio</option><option value="2">Ruim</option></select>
            </div>

            <label class="mt-3 small fw-bold">Pulsos (Ex: P+, TA---, BP++)</label>
            <input type="text" id="pulsos" class="form-control" placeholder="Marque os desequil√≠brios">

            <label class="mt-3 small fw-bold">L√≠ngua (Captura Visual)</label>
            <div id="visor">
                <video id="v" autoplay playsinline></video>
                <img id="foto" style="display:none;">
                <div class="moldura"></div>
            </div>
            <button id="btn-snap" class="btn btn-sm btn-dark w-100 mt-2" onclick="snap()">üì∏ TIRAR FOTO</button>

            <div id="dados-lingua" style="display:none" class="mt-3">
                <select id="cor" class="form-select mb-2">
                    <option value="rosada">L√≠ngua Rosada</option>
                    <option value="palida">L√≠ngua P√°lida</option>
                    <option value="vermelha">L√≠ngua Vermelha</option>
                </select>
                <select id="sab" class="form-select">
                    <option value="fina">Saburra Fina</option>
                    <option value="grossa">Saburra Grossa/Branca</option>
                    <option value="amarela">Saburra Amarela</option>
                </select>
                <button class="btn-pro" onclick="processar()">GERAR CONDUTA</button>
            </div>
        </div>
    </div>

    <div id="p3" class="etapa">
        <div class="card-clinico" style="border-left-color: var(--sucesso);">
            <h5 class="fw-bold">S√çNTESE & CONDUTA SUGERIDA</h5>
            <div id="relatorio" class="small mt-3"></div>
            
            <div id="sugestao" class="sugestao-box"></div>

            <button class="btn-pro" style="background: #25D366;" onclick="compartilhar()">
                üì≤ SALVAR NO WHATSAPP (PRONTU√ÅRIO)
            </button>
            <button class="btn btn-link btn-sm w-100 mt-2 text-muted" onclick="location.reload()">Novo Atendimento</button>
        </div>
    </div>

    <script>
        function ir(n) { document.querySelectorAll('.etapa').forEach(e => e.classList.remove('ativa')); document.getElementById('p' + n).classList.add('ativa'); }
        
        function snap() {
            const v = document.getElementById('v');
            const f = document.getElementById('foto');
            const canvas = document.createElement('canvas');
            canvas.width = v.videoWidth; canvas.height = v.videoHeight;
            canvas.getContext('2d').drawImage(v, 0, 0);
            f.src = canvas.toDataURL('image/png');
            v.style.display = 'none'; f.style.display = 'block';
            document.getElementById('dados-lingua').style.display = 'block';
            document.getElementById('btn-snap').style.display = 'none';
        }

        function abrirCam() { navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } }).then(s => { document.getElementById('v').srcObject = s; }); }

        function processar() {
            const id = document.getElementById('pacienteId').value;
            const ans = document.getElementById('ans').value;
            const pul = document.getElementById('pulsos').value.toUpperCase();
            const cor = document.getElementById('cor').value;
            const sab = document.getElementById('sab').value;

            let conduta = "<b>Estrat√©gia:</b> Harmoniza√ß√£o Geral.<br><b>Pontos:</b> IG4, F3, E36.";
            
            // L√ìGICA INTELIGENTE
            if(pul.includes('TA---') || sab === 'grossa') {
                conduta = "<b>Estrat√©gia:</b> Aquecer o Yang e Drenar Umidade-Frio.<br><b>Pontos:</b> VC12, TA5, BP9. <i>Considerar Moxa.</i>";
            } else if(ans > 1 && cor === 'vermelha') {
                conduta = "<b>Estrat√©gia:</b> Sedar Fogo do Cora√ß√£o e Acalmar Shen.<br><b>Pontos:</b> C7, CS6, VG20, Yintang.";
            }

            document.getElementById('relatorio').innerHTML = `
                <b>Paciente:</b> ${id}<br>
                <b>Data:</b> ${new Date().toLocaleDateString()}<br><hr>
                <b>Pulso:</b> ${pul}<br>
                <b>L√≠ngua:</b> ${cor} / Saburra ${sab}
            `;
            document.getElementById('sugestao').innerHTML = conduta;
            ir(3);
        }

        function compartilhar() {
            const id = document.getElementById('pacienteId').value;
            const cond = document.getElementById('sugestao').innerText;
            const texto = `*PRONTU√ÅRIO 360 - ${id}*\n\n${cond}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(texto)}`);
        }
        
        // Inicia c√¢mera ao chegar no p2
        window.ir = function(n) {
            document.querySelectorAll('.etapa').forEach(e => e.classList.remove('ativa'));
            document.getElementById('p' + n).classList.add('ativa');
            if(n === 2) abrirCam();
        }
    </script>
</body>
</html>
