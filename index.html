<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÉTODO 360 PRO | Prontuário</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --azul: #003366; --cinza: #f8f9fa; --danger: #dc3545; --success: #198754; }
        body { background: var(--cinza); font-family: 'Segoe UI', sans-serif; display: none; padding-bottom: 50px; }
        .card-clinico { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin: 15px auto; max-width: 600px; border-top: 6px solid var(--azul); }
        .etapa { display: none; }
        .ativa { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .pergunta-escala { border-bottom: 1px solid #eee; padding: 12px 0; }
        .label-pergunta { font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 8px; color: #444; }
        .grid-pulsos { display: grid; grid-template-columns: 1fr; gap: 8px; }
        .item-pulso { background: #fff; border: 1px solid #eee; padding: 10px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; }
        .btn-scale { font-size: 0.7rem; padding: 5px 2px; min-width: 32px; border: 1px solid #ddd; }
        .btn-check:checked + .btn { background: var(--azul) !important; color: white !important; }
        .btn-pro { background: var(--azul); color: white; width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; margin-top: 20px; }
        
        /* Estilo EVA */
        .eva-btn { min-width: 35px; font-weight: bold; }
    </style>
</head>
<body id="corpoApp">

    <div id="p1" class="etapa ativa container mt-4">
        <div class="card-clinico">
            <h4 class="fw-bold text-center mb-4" style="color:var(--azul)">MÉTODO 360 PRO</h4>
            <label class="small fw-bold">ID do Paciente:</label>
            <input type="text" id="pacienteId" class="form-control mb-3" placeholder="Ex: MRO 5005">
            <label class="small fw-bold">Queixa Principal:</label>
            <textarea id="queixa" class="form-control mb-3" rows="3" placeholder="O que o trouxe hoje?"></textarea>
            <button class="btn-pro" onclick="ir(2)">INICIAR DIAGNÓSTICO (GAD-7)</button>
        </div>
    </div>

    <div id="p2" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">GAD-7 (Ansiedade Atual)</h5>
            <div id="questoesGad"></div>
            <button class="btn-pro" onclick="ir(3)">PRÓXIMO: SONO (IGI)</button>
        </div>
    </div>

    <div id="p3" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">Índice IGI (Sono)</h5>
            <div id="questoesIgi"></div>
            <button class="btn-pro" onclick="ir(4)">PRÓXIMO: EVA PRÉ</button>
        </div>
    </div>

    <div id="p4" class="etapa container mt-4">
        <div class="card-clinico text-center">
            <h5 class="fw-bold border-bottom pb-2">EVA PRÉ-ATENDIMENTO</h5>
            <p class="small text-muted">Qual o seu nível de dor/desconforto agora (0-10)?</p>
            <div class="btn-group w-100 flex-wrap" id="evaPreContainer"></div>
            <button class="btn-pro" onclick="ir(5)">PRÓXIMO: EXAME CLÍNICO</button>
        </div>
    </div>

    <div id="p5" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2 text-primary">Pulsologia & Língua</h5>
            <div class="row mb-3">
                <div class="col-6"><label class="small fw-bold">Cor:</label><select id="cor" class="form-select"><option value="Rosada">Rosada</option><option value="Pálida">Pálida</option><option value="Vermelha">Vermelha</option><option value="Roxa">Roxa</option></select></div>
                <div class="col-6"><label class="small fw-bold">Saburra:</label><select id="sab" class="form-select"><option value="Fina">Fina</option><option value="Grossa">Grossa</option><option value="Geográfica">Geográfica</option></select></div>
            </div>
            <div class="grid-pulsos" id="listaPulsos"></div>
            <button class="btn-pro" onclick="ir(6)" style="background:var(--success)">REALIZAR TRATAMENTO -> EVA PÓS</button>
        </div>
    </div>

    <div id="p6" class="etapa container mt-4">
        <div class="card-clinico text-center">
            <h5 class="fw-bold border-bottom pb-2">EVA PÓS-ATENDIMENTO</h5>
            <p class="small text-muted">Como está o nível de dor/desconforto após a sessão?</p>
            <div class="btn-group w-100 flex-wrap" id="evaPosContainer"></div>
            <button class="btn-pro" onclick="finalizar()">FINALIZAR RELATÓRIO</button>
        </div>
    </div>

    <div id="p7" class="etapa container mt-4">
        <div class="card-clinico">
            <h4 class="fw-bold text-success border-bottom pb-2 text-center">Síntese do Atendimento</h4>
            <div id="relatorio" class="mt-3"></div>
            <button class="btn-pro" onclick="window.print()">IMPRIMIR / PDF</button>
            <button class="btn btn-link w-100 mt-2 text-muted" onclick="location.reload()">Novo Atendimento</button>
        </div>
    </div>

    <script>
        const PIN = "1234";
        if(prompt("PIN do Terapeuta:") !== PIN) { document.body.innerHTML = "Bloqueado"; } else { document.body.style.display = "block"; }

        // GERAR GAD-7 E IGI
        const gadP = ["Nervoso/Ansioso", "Controlar preocupação", "Preocupação excessiva", "Dificuldade relaxar", "Agitação", "Irritabilidade", "Medo do pior"];
        const igiP = ["Dificuldade adormecer", "Dificuldade manter sono", "Acordar cedo", "Satisfação", "Interferência", "Perceção alheia", "Preocupação"];

        function gerarEscala(id, p, max) {
            const cont = document.getElementById(id);
            p.forEach((txt, i) => {
                let btns = "";
                for(let n=0; n<=max; n++) btns += `<input type="radio" class="btn-check" name="${id}_${i}" id="${id}_${i}_${n}" value="${n}" ${n===0?'checked':''}><label class="btn btn-outline-secondary btn-sm me-1" for="${id}_${i}_${n}">${n}</label>`;
                cont.innerHTML += `<div class="pergunta-escala"><span class="label-pergunta">${txt}</span><div class="btn-group">${btns}</div></div>`;
            });
        }
        gerarEscala("questoesGad", gadP, 3);
        gerarEscala("questoesIgi", igiP, 4);

        // GERAR EVA
        function gerarEva(id) {
            const cont = document.getElementById(id);
            for(let n=0; n<=10; n++) {
                cont.innerHTML += `<input type="radio" class="btn-check" name="${id}" id="${id}_${n}" value="${n}" ${n===0?'checked':''}><label class="btn btn-outline-primary eva-btn m-1" for="${id}_${n}">${n}</label>`;
            }
        }
        gerarEva("evaPreContainer");
        gerarEva("evaPosContainer");

        // GERAR PULSOS
        const meridianos = ["P", "IG", "BP", "E", "C", "ID", "R", "B", "CS", "TA", "F", "VB"];
        const gridP = document.getElementById('listaPulsos');
        meridianos.forEach(m => {
            let btns = ["---","--","-","ok","+","++","+++"].map(n => `<input type="radio" class="btn-check" name="p_${m}" id="${m}_${n}" value="${n}" ${n==='ok'?'checked':''}><label class="btn btn-outline-secondary btn-scale" for="${m}_${n}">${n}</label>`).join('');
            gridP.innerHTML += `<div class="item-pulso"><span class="sigla">${m}</span><div class="btn-group">${btns}</div></div>`;
        });

        function ir(n) { document.querySelectorAll('.etapa').forEach(e => e.classList.remove('ativa')); document.getElementById('p' + n).classList.add('ativa'); window.scrollTo(0,0); }

        function finalizar() {
            let gad = 0; document.querySelectorAll('[name^="questoesGad_"]:checked').forEach(i => gad += parseInt(i.value));
            let igi = 0; document.querySelectorAll('[name^="questoesIgi_"]:checked').forEach(i => igi += parseInt(i.value));
            let pre = parseInt(document.querySelector('[name="evaPreContainer"]:checked').value);
            let pos = parseInt(document.querySelector('[name="evaPosContainer"]:checked').value);
            let pulsos = []; meridianos.forEach(m => { let v = document.querySelector(`input[name="p_${m}"]:checked`).value; if(v!=='ok') pulsos.push(`<b>${m}:</b> ${v}`); });

            document.getElementById('relatorio').innerHTML = `
                <b>Paciente:</b> ${document.getElementById('pacienteId').value}<br>
                <b>Queixa:</b> ${document.getElementById('queixa').value}<hr>
                <div class='row text-center'>
                    <div class='col-6 bg-light p-2 border'><b>GAD-7:</b> ${gad} pts</div>
                    <div class='col-6 bg-light p-2 border'><b>IGI:</b> ${igi} pts</div>
                </div>
                <div class='mt-3 p-3 text-center rounded ${pos < pre ? 'bg-success text-white' : 'bg-warning'}'>
                    <b>Evolução da Dor (EVA):</b><br>
                    De ${pre} para ${pos} (Redução de ${pre-pos} pontos)
                </div>
                <hr>
                <b>Pulsos Alterados:</b> ${pulsos.join(' | ') || 'Normais'}<br>
                <b>Língua:</b> ${document.getElementById('cor').value} / ${document.getElementById('sab').value}
            `;
            ir(7);
        }
    </script>
</body>
</html>
