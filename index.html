<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÉTODO 360 PRO | Clínica</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --azul: #003366; --dourado: #B8860B; --cinza: #f8f9fa; }
        body { background: var(--cinza); font-family: 'Segoe UI', sans-serif; display: none; padding-bottom: 50px; }
        .card-clinico { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin: 15px auto; max-width: 600px; border-top: 6px solid var(--azul); }
        .etapa { display: none; }
        .ativa { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .pergunta-escala { border-bottom: 1px solid #eee; padding: 10px 0; }
        .label-pergunta { font-size: 0.9rem; font-weight: 500; display: block; margin-bottom: 8px; }
        .sigla { font-weight: 800; color: var(--azul); width: 45px; }
        .grid-pulsos { display: grid; grid-template-columns: 1fr; gap: 8px; }
        .item-pulso { background: #fff; border: 1px solid #eee; padding: 10px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; }
        .btn-scale { font-size: 0.7rem; padding: 5px 2px; min-width: 32px; border: 1px solid #ddd; }
        .btn-check:checked + .btn { background: var(--azul) !important; color: white !important; }
        .btn-pro { background: var(--azul); color: white; width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; margin-top: 20px; }
        .badge-resultado { font-size: 1rem; padding: 10px; border-radius: 8px; display: block; text-align: center; margin-top: 10px; }
    </style>
</head>
<body id="corpoApp">

    <div id="p1" class="etapa ativa container mt-4">
        <div class="card-clinico text-center">
            <h3 class="fw-bold" style="color:var(--azul)">MÉTODO 360 PRO</h3>
            <p class="text-muted">Prontuário de Diagnóstico Integrado</p>
            <input type="text" id="pacienteId" class="form-control form-control-lg mb-3" placeholder="ID do Paciente">
            <button class="btn-pro" onclick="ir(2)">INICIAR GAD-7 (ANSIEDADE)</button>
        </div>
    </div>

    <div id="p2" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">Escala GAD-7 (Ansiedade)</h5>
            <p class="small text-muted">Nas últimas 2 semanas, com que frequência foi incomodado por:</p>
            
            <div id="questoesGad"></div> <button class="btn-pro" onclick="ir(3)">PRÓXIMO: IGI (SONO)</button>
        </div>
    </div>

    <div id="p3" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">Índice IGI (Insônia)</h5>
            <p class="small text-muted">Avalie a gravidade dos seus problemas de sono na última semana:</p>
            
            <div id="questoesIgi"></div> <button class="btn-pro" onclick="ir(4)">PRÓXIMO: PULSOS</button>
        </div>
    </div>

    <div id="p4" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">Exame dos 12 Pulsos</h5>
            <div class="grid-pulsos" id="listaPulsos"></div>
            <button class="btn-pro" onclick="ir(5)">PRÓXIMO: LÍNGUA</button>
        </div>
    </div>

    <div id="p5" class="etapa container mt-4">
        <div class="card-clinico">
            <h5 class="fw-bold border-bottom pb-2">Análise de Língua</h5>
            <label class="small fw-bold">Cor:</label>
            <select id="cor" class="form-select mb-3"><option value="Rosada">Rosada</option><option value="Pálida">Pálida</option><option value="Vermelha">Vermelha</option><option value="Roxa">Roxa</option></select>
            <label class="small fw-bold">Saburra:</label>
            <select id="sab" class="form-select"><option value="Fina">Fina</option><option value="Grossa">Grossa</option><option value="Geográfica">Geográfica</option></select>
            <button class="btn-pro" onclick="finalizar()">FINALIZAR DIAGNÓSTICO</button>
        </div>
    </div>

    <div id="p6" class="etapa container mt-4">
        <div class="card-clinico">
            <h4 class="fw-bold text-success border-bottom pb-2">Relatório Clínico</h4>
            <div id="relatorio" class="mt-3"></div>
            <button class="btn-pro" style="background:#25D366" onclick="window.print()">IMPRIMIR / PDF</button>
            <button class="btn btn-link w-100 mt-2 text-muted" onclick="location.reload()">Novo Atendimento</button>
        </div>
    </div>

    <script>
        const PIN = "1234";
        if(prompt("PIN do Terapeuta:") !== PIN) { document.body.innerHTML = "Acesso Negado"; } else { document.body.style.display = "block"; }

        const gadPerguntas = ["Sentir-se nervoso, ansioso ou muito tenso", "Não ser capaz de impedir ou de controlar as preocupações", "Preocupar-se demais com diversas coisas", "Dificuldade para relaxar", "Ficar tão agitado que se torna difícil permanecer sentado", "Tornar-se facilmente irritável ou chateado", "Sentir medo como se algo horrível fosse acontecer"];
        const igiPerguntas = ["Dificuldade em adormecer", "Dificuldade em manter o sono", "Problemas por acordar muito cedo", "Satisfação com o padrão atual de sono", "Interferência no funcionamento diário", "Perceção dos outros sobre o seu problema", "Preocupação/Angústia com o sono"];

        function gerarEscala(idAlvo, perguntas, max) {
            const container = document.getElementById(idAlvo);
            perguntas.forEach((p, i) => {
                let opcoes = "";
                for(let n=0; n<=max; n++) {
                    opcoes += `<input type="radio" class="btn-check" name="${idAlvo}_${i}" id="${idAlvo}_${i}_${n}" value="${n}" ${n===0?'checked':''}><label class="btn btn-outline-secondary btn-sm me-1" for="${idAlvo}_${i}_${n}">${n}</label>`;
                }
                container.innerHTML += `<div class="pergunta-escala"><span class="label-pergunta">${p}</span><div class="btn-group">${opcoes}</div></div>`;
            });
        }

        gerarEscala("questoesGad", gadPerguntas, 3);
        gerarEscala("questoesIgi", igiPerguntas, 4);

        const meridianos = ["P", "IG", "BP", "E", "C", "ID", "R", "B", "CS", "TA", "F", "VB"];
        const gridP = document.getElementById('listaPulsos');
        meridianos.forEach(m => {
            let botoes = ["---","--","-","ok","+","++","+++"].map(n => `<input type="radio" class="btn-check" name="p_${m}" id="${m}_${n}" value="${n}" ${n==='ok'?'checked':''}><label class="btn btn-outline-secondary btn-scale" for="${m}_${n}">${n}</label>`).join('');
            gridP.innerHTML += `<div class="item-pulso"><span class="sigla">${m}</span><div class="btn-group">${botoes}</div></div>`;
        });

        function ir(n) { document.querySelectorAll('.etapa').forEach(e => e.classList.remove('ativa')); document.getElementById('p' + n).classList.add('ativa'); window.scrollTo(0,0); }

        function finalizar() {
            let totalGad = 0; document.querySelectorAll('[name^="questoesGad_"]:checked').forEach(i => totalGad += parseInt(i.value));
            let totalIgi = 0; document.querySelectorAll('[name^="questoesIgi_"]:checked').forEach(i => totalIgi += parseInt(i.value));
            
            let statusGad = totalGad <= 4 ? "Mínima" : totalGad <= 9 ? "Leve" : totalGad <= 14 ? "Moderada" : "Grave";
            let statusIgi = totalIgi <= 7 ? "Ausente" : totalIgi <= 14 ? "Sub-clínica" : totalIgi <= 21 ? "Moderada" : "Grave";

            let pulsos = []; meridianos.forEach(m => { let v = document.querySelector(`input[name="p_${m}"]:checked`).value; if(v!=='ok') pulsos.push(`<b>${m}:</b> ${v}`); });

            document.getElementById('relatorio').innerHTML = `
                <b>Paciente:</b> ${document.getElementById('pacienteId').value}<br>
                <b>Data:</b> ${new Date().toLocaleDateString()}<hr>
                <div class="badge-resultado bg-primary text-white">GAD-7: ${totalGad} pts (${statusGad})</div>
                <div class="badge-resultado bg-info text-white mt-2">IGI: ${totalIgi} pts (${statusIgi})</div>
                <hr><b>Pulsos Alterados:</b> ${pulsos.join(' | ') || 'Equilíbrio'}<br>
                <b>Língua:</b> ${document.getElementById('cor').value} / ${document.getElementById('sab').value}
            `;
            ir(6);
        }
    </script>
</body>
</html>
